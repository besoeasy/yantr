services:
  database:
    image: postgres:11
    container_name: klaxon_database
    volumes:
      - klaxon_db:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=${POSTGRES_USER:-postgres}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-postgres}
      - POSTGRES_DB=${POSTGRES_DB:-klaxon}
    restart: unless-stopped

  klaxon:
    image: mediadepot/klaxon
    container_name: klaxon
    labels:
      yantra.name: "Klaxon"
      yantra.category: "notification,alert"
      yantra.port: "3000 (HTTP - Web UI)"
      yantra.description: "Open source alerting and anomaly detection platform with webhooks"
      yantra.website: "https://github.com/xo/klaxon"
    ports:
      - "3000"
    volumes:
      - klaxon_config:/config
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgres://postgres:postgres@database/klaxon}
      - SECRET_KEY_BASE=${SECRET_KEY_BASE:-changeme}
    depends_on:
      - database
    restart: unless-stopped

volumes:
  klaxon_db:
  klaxon_config:
